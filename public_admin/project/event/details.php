<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/event.php';$eventObject	= new class_event();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$eventData = $eventObject->getByCode($code);		if($eventData) {		$smarty->assign('eventData', $eventData);	} else {		header('Location: /project/event/');		exit;			}}/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;		if(isset($_POST['event_name']) && trim($_POST['event_name']) == '') {		$errorArray['event_name'] = 'Please add a name';		$formValid = false;			}		if(isset($_POST['project_code']) && trim($_POST['project_code']) == '') {		$errorArray['project_code'] = 'Please add a project this event is under';		$formValid = false;			}		if(isset($_POST['event_description']) && trim($_POST['event_description']) == '' ) {		$errorArray['event_description'] = 'Please add a description';		$formValid = false;			} else if(strlen(trim($_POST['event_description'])) > 255) {		$errorArray['event_description'] = 'characters need to be less than 255 characters';		$formValid = false;				}		if(isset($_POST['event_date_start']) && trim($_POST['event_date_start']) != '') {		if(trim($_POST['event_date_start']) != date('Y-m-d H:i', strtotime(trim($_POST['event_date_start'])))) {			$errorArray['event_date_start'] = 'Please add a valid start date';			$formValid = false;				}	} else {		$errorArray['event_date_start'] = 'Please add a start date for the event';		$formValid = false;	}	if(isset($_POST['event_date_end']) && trim($_POST['event_date_end']) != '') {		if(trim($_POST['event_date_end']) != date('Y-m-d H:i', strtotime(trim($_POST['event_date_end'])))) {			$errorArray['event_date_end'] = 'Please add a valid end date';			$formValid = false;				}	} else {		$errorArray['event_date_end'] = 'Please add an end date for the event';		$formValid = false;	}		if(isset($_POST['event_page']) && trim($_POST['event_page']) == '') {		$errorArray['event_page'] = 'Please add a page';		$formValid = false;			}		if(count($errorArray) == 0 && $formValid == true) {				$data 	= array();			$data['event_name']				= trim($_POST['event_name']);							$data['event_description']		= trim($_POST['event_description']);				$data['project_code']				= trim($_POST['project_code']);		$data['event_page']				= trim($_POST['event_page']);		$data['event_date_start']		= trim($_POST['event_date_start']).':00';				$data['event_date_end']			= trim($_POST['event_date_end']).':59';						if(!isset($eventData)) {			$success = $eventObject->insert($data);						} else {			$where		= $eventObject->getAdapter()->quoteInto('event_code = ?', $eventData['event_code']);			$eventObject->update($data, $where);					$success 	= $eventData['event_code'];					}				if(count($errorArray) == 0) {			header('Location: /project/event/');				exit;				}	}		/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('project/event/details.tpl');?>